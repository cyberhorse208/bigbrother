# /proc/net/tcp 文件格式解释

/proc/net/tcp文件记录了系统当前的tcp连接状态；netstat命令就是通过读取此文件来展示tcp连接的。

此文件开头有列出每一列的名字，然后列出当前存在的tcp连接，如下：

```bash
 sl  local_address rem_address   st tx_queue rx_queue tr tm->when retrnsmt   uid  timeout inode
   0: 0101007F:0035 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 21793 1 0000000000000000 100 0 0 10 0
   1: 2703A8C0:ECDC 2228D0CB:01BB 01 00000000:00000000 00:00000000 00000000  1000        0 73878 1 0000000000000000 22 4 31 10 -1
   2: 2703A8C0:BCDE 6C2161B4:01BB 01 00000000:00000000 02:0000021F 00000000  1000        0 71571 2 0000000000000000 21 4 20 10 -1
   3: 2703A8C0:83B8 D331BADE:0050 02 00000001:00000000 01:000006E8 00000005  1000        0 73802 2 0000000000000000 3200 0 0 1 7
   4: 2703A8C0:EBB6 92A9C965:01BB 02 00000001:00000000 01:0000094F 00000005  1000        0 73856 2 0000000000000000 3200 0 0 1 7
   5: 2703A8C0:A868 1DE0FEAD:0050 02 00000001:00000000 01:00000102 00000005  1000        0 72863 2 0000000000000000 3200 0 0 1 7
   6: 2703A8C0:9528 7A11D83A:0050 01 00000000:00000000 02:00000000 00000000  1000        0 72568 2 0000000000000000 22 4 22 10 -1
   7: 2703A8C0:901C CB6E66CA:0050 02 00000001:00000000 01:000007B5 00000005  1000        0 73826 2 0000000000000000 3200 0 0 1 7
   8: 2703A8C0:8310 CC6E66CA:0050 02 00000001:00000000 01:00000028 00000004  1000        0 73933 2 0000000000000000 1600 0 0 1 7
   9: 2703A8C0:DB42 5CD3EF73:0050 02 00000001:00000000 01:000000A8 00000004  1000        0 73938 2 0000000000000000 1600 0 0 1 7
  10: 2703A8C0:D8EA 06D97A75:0050 01 00000000:00000000 02:000003A3 00000000  1000        0 73993 2 0000000000000000 24 4 32 10 -1
  11: 2703A8C0:A4F4 7AD7DA3A:0050 02 00000001:00000000 01:000006CF 00000005  1000        0 73799 2 0000000000000000 3200 0 0 1 7
  12: 2703A8C0:83A6 D331BADE:0050 02 00000001:00000000 01:000006CF 00000005  1000        0 73793 2 0000000000000000 3200 0 0 1 7
  13: 2703A8C0:9042 CB6E66CA:0050 02 00000001:00000000 01:00000902 00000005  1000        0 73845 2 0000000000000000 3200 0 0 1 7
  14: 2703A8C0:902E CB6E66CA:0050 02 00000001:00000000 01:000007CF 00000005  1000        0 73835 2 0000000000000000 3200 0 0 1 7
  15: 2703A8C0:9048 CB6E66CA:0050 02 00000001:00000000 01:0000091C 00000005  1000        0 73849 2 0000000000000000 3200 0 0 1 7

# another sample

  sl  local_address rem_address   st tx_queue rx_queue tr tm->when retrnsmt   uid  timeout inode
   0: 0101007F:0035 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 21793 1 0000000000000000 100 0 0 10 0
   1: 2703A8C0:8876 5DA9D374:0050 04 00000001:00000000 01:0000011B 00000003     0        0 0 3 0000000000000000 832 4 0 1 7
   2: 2703A8C0:A160 214261B4:01BB 06 00000000:00000000 03:000013D6 00000000     0        0 0 3 0000000000000000
   3: 2703A8C0:B9B6 BC22E17A:0050 06 00000000:00000000 03:000006B6 00000000     0        0 0 3 0000000000000000
   4: 2703A8C0:88FE CFA4E37A:0050 06 00000000:00000000 03:0000120E 00000000     0        0 0 3 0000000000000000
   5: 2703A8C0:B1E8 66C01368:0050 08 00000000:00000001 00:00000000 00000000  1000        0 98971 1 0000000000000000 115 4 26 10 -1
   6: 2703A8C0:AF16 66A0E365:01BB 01 00000000:00000000 02:00000044 00000000  1000        0 95544 2 0000000000000000 110 4 26 2 7
   7: 2703A8C0:CC88 BD22E17A:0050 06 00000000:00000000 03:0000077E 00000000     0        0 0 3 0000000000000000
   8: 2703A8C0:B9F8 BC22E17A:0050 04 00000001:00000000 01:000003FB 00000004     0        0 0 3 0000000000000000 1184 4 0 1 7
   9: 2703A8C0:B9AC BC22E17A:0050 06 00000000:00000000 03:000006B6 00000000     0        0 0 3 0000000000000000
  10: 2703A8C0:A900 41131868:01BB 01 00000000:00000000 00:00000000 00000000  1000        0 99136 1 0000000000000000 54 4 14 10 -1
  11: 2703A8C0:C354 6C2161B4:01BB 01 00000000:00000000 02:000000DD 00000000  1000        0 102669 2 0000000000000000 20 5 24 4 -1
  12: 2703A8C0:E2F6 6B2161B4:01BB 06 00000000:00000000 03:0000166B 00000000     0        0 0 3 0000000000000000
  13: 2703A8C0:A608 41131868:01BB 01 00000000:00000000 00:00000000 00000000  1000        0 78536 1 0000000000000000 81 4 14 10 -1
  14: 2703A8C0:9DDA 66C01368:01BB 01 00000000:00000000 00:00000000 00000000  1000        0 78548 1 0000000000000000 53 4 1 10 -1
  15: 2703A8C0:CC8A BD22E17A:0050 06 00000000:00000000 03:0000071A 00000000     0        0 0 3 0000000000000000
  16: 2703A8C0:924C 66C41368:01BB 01 00000000:00000000 00:00000000 00000000  1000        0 99258 1 0000000000000000 112 4 9 10 -1
  17: 2703A8C0:D4A0 2729D0CB:01BB 01 00000000:00000000 00:00000000 00000000  1000        0 102532 1 0000000000000000 23 4 30 10 -1
  18: 2703A8C0:C342 6C2161B4:01BB 01 00000000:00000000 02:000002DD 00000000  1000        0 102631 2 0000000000000000 21 4 18 10 -1
  19: 2703A8C0:B1EA 66C01368:0050 08 00000000:00000001 00:00000000 00000000  1000        0 98973 1 0000000000000000 116 4 18 10 -1
  20: 2703A8C0:A164 214261B4:01BB 06 00000000:00000000 03:000016AD 00000000     0        0 0 3 0000000000000000
  21: 2703A8C0:B9AE BC22E17A:0050 06 00000000:00000000 03:000006B6 00000000     0        0 0 3 0000000000000000
  22: 2703A8C0:B9B2 BC22E17A:0050 06 00000000:00000000 03:000006B6 00000000     0        0 0 3 0000000000000000
  23: 2703A8C0:CC8C BD22E17A:0050 06 00000000:00000000 03:0000077E 00000000     0        0 0 3 0000000000000000
  24: 2703A8C0:D516 7DFD1EC0:01BB 01 00000000:00000000 02:000054DE 00000000  1000        0 100528 2 0000000000000000 65 4 27 7 7
  25: 2703A8C0:BA04 BC22E17A:0050 04 00000001:00000000 01:000001D4 00000004     0        0 0 3 0000000000000000 915 4 0 1 7
  26: 2703A8C0:8900 CFA4E37A:0050 06 00000000:00000000 03:0000120D 00000000     0        0 0 3 0000000000000000

```

格式参考  www.linuxdevcenter.com/pub/a/linux/2000/11/16/LinuxAdmin.html


我们主要关注的列是，local_address本地地址:端口、rem_address远程地址:端口、st连接状态、inode。




* 注1：文件中都是用的16进制，所以HTTP的80端口记录为0050。

* 注2：ip地址的16进制需要先做字节序转换，才能对应到点分式的ip地址形式。

* 注3：状态码对应如下
```
00  “ERROR_STATUS”,
01  “TCP_ESTABLISHED”,
02  “TCP_SYN_SENT”,
03  “TCP_SYN_RECV”,
04  “TCP_FIN_WAIT1″,
05  “TCP_FIN_WAIT2″,
06  “TCP_TIME_WAIT”,
07  “TCP_CLOSE”,
08  “TCP_CLOSE_WAIT”,
09  “TCP_LAST_ACK”,
0A  “TCP_LISTEN”,
0B  “TCP_CLOSING”,
```

* 注4：

> 非0的inode号可以唯一的标示一个非TIME-WAIT状态的socket（对应一个local_address+rem_address对），因此，我们关注同一个inode的状态变迁即可得知对应的socket的状态变迁。

> 为0的inode表示的tcp连接都处于TIME-WAIT状态，即将被系统回收。